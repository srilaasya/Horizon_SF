<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            margin-top: 50px;
        }

        #messageLog {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 20px;
        }

        .control-group {
            margin-bottom: 15px;
        }
        .btn-group {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="text-center">Order Management</h1>
        
        <div id="messageLog" class="mb-4"></div>
        
        <div class="mb-4">
            <input type="text" id="custom_message" class="form-control" placeholder="Enter custom message">
            <div class="control-group mt-2">
                <label>Brightness:</label>
                <div class="btn-group" role="group">
                    <button onclick="setBrightness(5)" class="btn btn-secondary">Low</button>
                    <button onclick="setBrightness(10)" class="btn btn-secondary">Medium</button>
                    <button onclick="setBrightness(15)" class="btn btn-secondary">High</button>
                </div>
            </div>
            <div class="control-group">
                <label>Text Color:</label>
                <select id="textColor" class="form-control" onchange="setColor(this.value)">
                    <option value="WHITE">White</option>
                    <option value="GREEN">Green</option>
                    <option value="RED">Red</option>
                    <option value="BLUE">Blue</option>
                    <option value="YELLOW">Yellow</option>
                </select>
            </div>
            <div class="control-group">
                <label>Text Position:</label>
                <div class="btn-group" role="group">
                    <button onclick="setPosition('top-left')" class="btn btn-secondary">Top Left</button>
                    <button onclick="setPosition('top-center')" class="btn btn-secondary">Top Center</button>
                    <button onclick="setPosition('top-right')" class="btn btn-secondary">Top Right</button>
                </div>
                <div class="btn-group mt-2" role="group">
                    <button onclick="setPosition('center-left')" class="btn btn-secondary">Center Left</button>
                    <button onclick="setPosition('center')" class="btn btn-secondary">Center</button>
                    <button onclick="setPosition('center-right')" class="btn btn-secondary">Center Right</button>
                </div>
                <div class="btn-group mt-2" role="group">
                    <button onclick="setPosition('bottom-left')" class="btn btn-secondary">Bottom Left</button>
                    <button onclick="setPosition('bottom-center')" class="btn btn-secondary">Bottom Center</button>
                    <button onclick="setPosition('bottom-right')" class="btn btn-secondary">Bottom Right</button>
                </div>
            </div>
            <button onclick="sendMessage()" class="btn btn-success mt-2">Display Message on Glasses</button>
        </div>
        
        <form id="orderForm" class="mb-4">
            <div class="form-group">
                <label for="customer">Customer Name</label>
                <input type="text" class="form-control" id="customer" name="customer" required>
            </div>
            <div class="form-group">
                <label for="order">Order</label>
                <input type="text" class="form-control" id="order" name="order" required>
            </div>
            <div class="form-group">
                <label for="dietary_restrictions">Dietary Restrictions</label>
                <input type="text" class="form-control" id="dietary_restrictions" name="dietary_restrictions">
            </div>
            <label for="color">Text Color:</label>
            <select id="color" name="color">
                <option value="WHITE">White</option>
                <option value="GREY">Grey</option>
                <option value="RED">Red</option>
                <option value="PINK">Pink</option>
                <option value="DARKBROWN">Dark Brown</option>
                <option value="BROWN">Brown</option>
                <option value="ORANGE">Orange</option>
                <option value="YELLOW">Yellow</option>
                <option value="DARKGREEN">Dark Green</option>
                <option value="GREEN">Green</option>
                <option value="LIGHTGREEN">Light Green</option>
                <option value="NIGHTBLUE">Night Blue</option>
                <option value="SEABLUE">Sea Blue</option>
                <option value="SKYBLUE">Sky Blue</option>
                <option value="CLOUDBLUE">Cloud Blue</option>
            </select>
            <button type="submit" class="btn btn-primary">Submit Order</button>
        </form>

        <h2>Current Orders</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Order</th>
                    <th>Dietary Restrictions</th>
                </tr>
            </thead>
            <tbody id="orders-table-body">
                {% for order in orders %}
                <tr>
                    <td>{{ order.customer }}</td>
                    <td>{{ order.order }}</td>
                    <td>{{ order.dietary_restrictions }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script>
        var socket = io();
        var currentBrightness = 15;
        var currentPosition = 'center';
        var currentColor = 'WHITE';
        var currentMessage = '';

        function updateDisplay() {
            if (currentMessage) {
                socket.emit('display_message', {
                    text: currentMessage,
                    brightness: currentBrightness,
                    color: currentColor,
                    position: currentPosition
                }, function(response) {
                    console.log("Received response:", response);
                    if (response.status === 'success') {
                        console.log("Display updated successfully");
                        addMessage("Display updated: " + currentMessage);
                    } else {
                        console.error("Error updating display");
                        addMessage("Error updating display: " + currentMessage);
                    }
                });
            }
        }

        function addMessage(message) {
            var messageLog = document.getElementById('messageLog');
            var messageElement = document.createElement('p');
            messageElement.textContent = message;
            messageLog.appendChild(messageElement);
            messageLog.scrollTop = messageLog.scrollHeight;
        }

        function setBrightness(value) {
            currentBrightness = value;
            console.log("Brightness set to:", value);
            updateDisplay();
        }

        function setPosition(position) {
            currentPosition = position;
            console.log("Position set to:", position);
            updateDisplay();
        }

        function setColor(color) {
            currentColor = color;
            console.log("Color set to:", color);
            updateDisplay();
        }

        function sendMessage() {
            var message = document.getElementById('custom_message').value;
            if (message) {
                currentMessage = message;
                updateDisplay();
                document.getElementById('custom_message').value = ''; // Clear the input field
            }
        }

        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            var formData = new FormData(this);
            fetch('/', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    addMessage('Order added successfully!');
                    location.reload(); // Reload the page to show the new order
                } else {
                    addMessage('Error adding order.');
                }
            });
        });
    </script>
</body>

</html>